<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <title>BantuJeg - Order Cepat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <!-- ========================
         VIEW: LOGIN
         ======================== -->
    <div id="view-login">
        <div class="brand-name">BantuJeg.</div>
        <div class="login-subtitle">Masuk untuk mulai pesan ojek &amp; kurir ğŸ›µ</div>
        <div class="login-box">
            <h2>Masuk dengan No. HP</h2>
            <div class="login-input-group">
                <input type="tel" id="phone-input" placeholder="Contoh: 08123456789" autocomplete="tel">
            </div>
            <button class="btn-login" onclick="requestLogin()">Kirim Magic Link â†’</button>
            <p class="login-note">Link masuk akan dikirim ke WhatsApp kamu.</p>
        </div>
    </div>

    <!-- ========================
         VIEW: MAIN APP
         ======================== -->
    <div id="view-main">

        <header>
            <div class="brand-container">
                <div class="brand-name">BantuJeg.</div>
                <div class="greeting">Siap Antar Kamu! ğŸ‘‹</div>
            </div>
            <div class="pulse" id="status-dot"></div>
        </header>

        <div id="map-wrapper">
            <div id="map-container">
                <div id="map"></div>
            </div>
        </div>

        <div class="card-interface">

            <div id="history-chip" onclick="useHistory()">
                <span id="history-text">ğŸ•’ Pakai Rute Terakhir...</span>
                <div style="font-size:1.2rem">â†ªï¸</div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="setService('RIDE', this)">ğŸ›µ OJEK</div>
                <div class="tab" onclick="setService('SEND', this)">ğŸ“¦ SEND</div>
                <div class="tab" onclick="setService('FOOD_MART', this)">ğŸœ FOOD &amp; MART</div>
                <div class="tab" onclick="setService('CAR', this)">ğŸš— MOBIL</div>
            </div>

            <div class="input-group">
                <div class="input-wrapper" id="wrapper-origin">
                    <span class="input-icon">ğŸ“</span>
                    <input type="text" id="origin" placeholder="Jemput di mana? (Cari Masjid/Sekolah)"
                        onfocus="setActiveField('pickup'); expandMap()" oninput="handleInput('origin')"
                        aria-label="Lokasi penjemputan" autocomplete="off">
                    <div class="clear-btn" id="clear-origin" onclick="clearInput('origin')" role="button" tabindex="0"
                        aria-label="Hapus lokasi penjemputan">âœ•</div>
                </div>
                <div class="input-actions" id="actions-origin">
                    <div class="action-btn map-picker" onclick="openMapPicker('origin')">ğŸ—ºï¸ Pilih lewat peta</div>
                    <div class="action-btn gps-btn" id="gps-origin" onclick="getCurrentLocation('origin')"
                        style="display:none;">ğŸ¯ Lokasi Saya</div>
                </div>
            </div>

            <div class="input-group">
                <div class="input-wrapper" id="wrapper-destination">
                    <span class="input-icon">ğŸ</span>
                    <input type="text" id="destination" placeholder="Antar ke mana?" onfocus="setActiveField('dropoff')"
                        oninput="handleInput('destination')" aria-label="Lokasi tujuan" autocomplete="off">
                    <div class="clear-btn" id="clear-destination" onclick="clearInput('destination')" role="button"
                        tabindex="0" aria-label="Hapus lokasi tujuan">âœ•</div>
                </div>
                <div class="input-actions" id="actions-destination">
                    <div class="action-btn map-picker" onclick="openMapPicker('destination')">ğŸ—ºï¸ Pilih lewat peta</div>
                    <div class="action-btn gps-btn" id="gps-destination" onclick="getCurrentLocation('destination')"
                        style="display:none;">ğŸ¯ Lokasi Saya</div>
                </div>
            </div>

            <div class="input-group">
                <div class="input-wrapper">
                    <span class="input-icon">ğŸ“</span>
                    <textarea id="note" rows="1" placeholder="Catatan (Pagar hitam, dll)"
                        oninput="updateLink(); toggleClearBtn('note')" aria-label="Catatan tambahan"
                        autocomplete="off"></textarea>
                    <div class="clear-btn" id="clear-note" onclick="clearInput('note')" role="button" tabindex="0"
                        aria-label="Hapus catatan">âœ•</div>
                </div>
                <div class="note-chips">
                    <div class="chip" onclick="addNote('Uang Pas')">Uang Pas</div>
                    <div class="chip" onclick="addNote('Pagar Hitam')">Pagar Hitam</div>
                    <div class="chip" onclick="addNote('Sesuai Titik')">Sesuai Titik</div>
                    <div class="chip" onclick="addNote('Jemput di Gang')">Jemput di Gang</div>
                </div>
                <div id="legal-warning">
                    âš ï¸ Dilarang kirim: Narkoba, Hewan, Senjata &amp; Barang Ilegal. Driver berhak cek barang.
                </div>
            </div>

            <div id="jastip-field" style="display: none;">
                <div class="input-group">
                    <div class="input-wrapper">
                        <span class="input-icon">ğŸ›’</span>
                        <textarea id="items" rows="2" placeholder="List belanjaan..." oninput="updateLink()"
                            aria-label="Daftar belanjaan" autocomplete="off"></textarea>
                    </div>
                </div>
                <div class="input-group">
                    <div class="input-wrapper">
                        <span class="input-icon">ğŸ’°</span>
                        <input type="number" id="est-price" placeholder="Estimasi harga barang (Rp)"
                            oninput="updateLink()" aria-label="Estimasi harga barang" autocomplete="off">
                    </div>
                </div>
            </div>

            <div class="car-options" id="car-options">
                <h4>Pilih Kursi</h4>
                <div class="option-row">
                    <label class="seat-option">
                        <input type="radio" name="car-seat" value="4" checked onchange="handleCarOptionChange()">
                        4 Seat
                    </label>
                    <label class="seat-option">
                        <input type="radio" name="car-seat" value="6" onchange="handleCarOptionChange()">
                        6 Seat
                    </label>
                </div>
                <label class="toll-option">
                    <input type="checkbox" id="car-toll" onchange="handleCarOptionChange()">
                    Lewat Tol (Biaya tol &amp; parkir ditanggung penumpang)
                </label>
            </div>

            <div class="payment-group">
                <label for="payment-method">ğŸ’³ Metode Pembayaran</label>
                <select id="payment-method">
                    <option value="CASH">ğŸ’µ Bayar Tunai (Cash)</option>
                    <option value="QRIS">ğŸ“± QRIS</option>
                </select>
            </div>

            <div class="error-card" id="error-card">
                âœ‹ Kejauhan Boss! Max 30km ya.
            </div>

            <div class="price-card" id="price-card">
                <div>
                    <div class="price-dist" id="dist-display">0 km</div>
                    <div class="fake-price" id="fake-price">Rp 0</div>
                    <div class="price-main">
                        <span id="price-display">Rp 0</span>
                        <span class="promo-tag">âš¡ Promo</span>
                    </div>
                </div>
                <div style="text-align: right; font-size: 0.8rem; opacity: 0.7;">
                    Tarif Resmi<br>BantuJeg
                </div>
            </div>

        </div><!-- /.card-interface -->

        <div class="bottom-bar">
            <button id="btn-submit" class="btn-cta disabled" onclick="submitOrder()">
                <span id="btn-text">Isi Lokasi Dulu</span>
                <div class="spinner" id="loading-spin"></div>
            </button>
        </div>

    </div><!-- /#view-main -->

    <!-- Map Picker Modal (outside view-main so it always overlays) -->
    <div id="map-picker-modal">
        <div class="picker-header">
            <button class="close-modal-btn" onclick="closeMapPicker()">âœ•</button>
            <h3 id="picker-title">Tentukan Titik Jemput</h3>
        </div>
        <div class="picker-map-container">
            <div id="picker-map"></div>
            <div class="center-pin">
                <div class="pin-label" id="pin-label">Lokasi Jemput</div>
                <div class="pin-icon">ğŸ“</div>
            </div>
        </div>
        <div class="picker-footer">
            <div class="address-display" id="picker-address">Geser peta untuk memilih lokasi...</div>
            <button class="confirm-location-btn" id="confirm-btn" onclick="confirmLocation()">KONFIRMASI LOKASI</button>
        </div>
    </div>

    <!-- Script Order: 1. Auth/API -> 2. App -> 3. Map -> 4. Google -->
    <script src="./js/auth.js"></script>
    <script src="./js/app.js"></script>
    <script src="./js/map.js"></script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXo3ErccnWYzKPXZsli1j9zsE5_50hO1g&libraries=places,geometry&callback=initMap"
        async defer></script>

</body>

</html>